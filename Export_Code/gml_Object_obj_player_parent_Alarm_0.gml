var _temp_local_var_2;
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_player_loadout_get_ammo_item

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_player_loadout_get_ammo

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_db_force_save

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 280
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_db_force_save

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 280
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_player_loadout_get_ammo

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_player_loadout_get_ammo_item

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
if (!reloading)
    return;
switch state_reload
{
    case (0 << 0):
        var _sound_time = now_reload_time * (global.sk_k[(17 << 0)])
        alarm[0] = _sound_time
        state_reload = (1 << 0)
        break
    case (1 << 0):
        var _weapon_reload_type = item_weapon_get_reload_type(arma_now)
        var _current_ammo_item = gml_Script_player_loadout_get_ammo_item(self, weapon_slot_now)
        var _current_ammo = gml_Script_player_loadout_get_ammo(self, weapon_slot_now)
        var _current_ammo_max = player_loadout_get_magazine_size(self, weapon_slot_now)
        var _deficit = max(0, (_current_ammo_max - _current_ammo))
        var sound_shell_in = snd_estrarre_caricatore
        switch _weapon_reload_type
        {
            case "sniper_single":
                sound_shell_in = snd_sniper_shell_in
                break
            case "shotgun_single":
                sound_shell_in = snd_shotgun_shell_in
                break
            case "magazine":
                sound_shell_in = snd_estrarre_caricatore
                break
        }

        _sound_time = audio_sound_length(sound_shell_in) * room_speed
        alarm[0] = _sound_time
        var ci_sono_ammo_per_reload_shell = false
        var _played_sound = false
        db_open(inventory_target_db())
        var _loot_array = db_read("Inventory", "items", [])
        db_close()
        var _i = 0
        repeat array_length(_loot_array)
        {
            var _loot = _loot_array[_i]
            var _item = _loot.item
            if (_item == _current_ammo_item)
            {
                ci_sono_ammo_per_reload_shell = true
                if (_weapon_reload_type == "shotgun_single" || _weapon_reload_type == "sniper_single")
                {
                    if (_deficit <= 0)
                        state_reload = (2 << 0)
                    else
                    {
                        _deficit = 1
                        state_reload = (0 << 0)
                        if (!_played_sound)
                        {
                            _played_sound = true
                            audio_play_sound(sound_shell_in, 10, false)
                        }
                        if (_deficit > 0)
                        {
                            if (_deficit < _loot.quantity)
                            {
                                var _ammo = gml_Script_player_loadout_get_ammo(self, weapon_slot_now)
                                _ammo += _deficit
                                player_loadout_set_ammo(weapon_slot_now, _ammo)
                                _loot.quantity -= _deficit
                                _deficit = 0
                            }
                            else
                            {
                                if (_deficit >= _loot.quantity)
                                {
                                    _ammo = gml_Script_player_loadout_get_ammo(self, weapon_slot_now)
                                    _ammo += _loot.quantity
                                    player_loadout_set_ammo(weapon_slot_now, _ammo)
                                    _deficit -= _loot.quantity
                                    array_delete(_loot_array, _i, 1)
                                    _i--
                                }
                                _i++
                                var _temp_local_var_2 = (array_length(_loot_array) - 1)
                                if (array_length(_loot_array) - 1)
                                    continue
                            }
                        }
                        else
                        {
                            _i++
                            var _temp_local_var_2 = (array_length(_loot_array) - 1)
                            if (array_length(_loot_array) - 1)
                                continue
                        }
                    }
                }
                else
                {
                    if (_weapon_reload_type == "magazine")
                    {
                        state_reload = (2 << 0)
                        if (!_played_sound)
                        {
                            _played_sound = true
                            audio_play_sound(sound_shell_in, 10, false)
                        }
                    }
                    if (_deficit > 0)
                    {
                        if (_deficit < _loot.quantity)
                        {
                            var _ammo = gml_Script_player_loadout_get_ammo(self, weapon_slot_now)
                            _ammo += _deficit
                            player_loadout_set_ammo(weapon_slot_now, _ammo)
                            _loot.quantity -= _deficit
                            _deficit = 0
                        }
                        else
                        {
                            if (_deficit >= _loot.quantity)
                            {
                                _ammo = gml_Script_player_loadout_get_ammo(self, weapon_slot_now)
                                _ammo += _loot.quantity
                                player_loadout_set_ammo(weapon_slot_now, _ammo)
                                _deficit -= _loot.quantity
                                array_delete(_loot_array, _i, 1)
                                _i--
                            }
                            _i++
                            var _temp_local_var_2 = (array_length(_loot_array) - 1)
                            if (array_length(_loot_array) - 1)
                                continue
                        }
                    }
                    else
                    {
                        _i++
                        var _temp_local_var_2 = (array_length(_loot_array) - 1)
                        if (array_length(_loot_array) - 1)
                            continue
                    }
                }
                break
            }
            else
                _i++
        }
        if is_in_hub()
            gml_Script_db_force_save("pre_raid")
        if (!ci_sono_ammo_per_reload_shell)
            state_reload = (2 << 0)
        break
    case (2 << 0):
        audio_play_sound(item_weapon_get_sound_mag_in(arma_now), 10, false)
        _sound_time = audio_sound_length(item_weapon_get_sound_mag_in(arma_now)) * room_speed
        var _sound_time_total = _sound_time * (global.sk_k[(17 << 0)])
        alarm[0] = _sound_time_total
        state_reload = (3 << 0)
        player_loadout_set_jammed(weapon_slot_now, false)
        break
    case (3 << 0):
        if reload_cocking
        {
            audio_play_sound(item_weapon_get_sound_cocking(arma_now), 10, false)
            var sound_time = audio_sound_length(item_weapon_get_sound_cocking(arma_now)) * room_speed
            alarm[0] = sound_time
            state_reload = (4 << 0)
            reload_cocking = false
        }
        else
        {
            alarm[0] = 1
            state_reload = (4 << 0)
        }
        player_loadout_set_jammed(weapon_slot_now, false)
        break
    case (4 << 0):
        reloading = false
        reload_cocking = false
        db_open(inventory_target_db())
        _loot_array = db_read("Inventory", "items", [])
        db_close()
        if is_in_hub()
            gml_Script_db_force_save("pre_raid")
        break
}

