/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_player_loadout_get_ammo_item

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_player_loadout_get_ammo

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for member variable name resolution) failed for gml_Script_db_force_save

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 280
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.<DecompileFromBlock>g__FindActualNameForAnonymousCodeObject|3_2(DecompileContext context, UndertaleCode anonymousCodeObject) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 563
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_player_loadout_get_ammo_item

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_db_force_save

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 280
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
/*
WARNING: Recursive script decompilation (for asset type resolution) failed for gml_Script_player_loadout_get_ammo

System.InvalidOperationException: Stack empty.
   at System.Collections.Generic.Stack`1.ThrowForEmptyStack()
   at System.Collections.Generic.Stack`1.Pop()
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block, List`1 tempvars, Stack`1 workQueue) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 235
   at UndertaleModLib.Decompiler.Decompiler.DecompileFromBlock(DecompileContext context, Dictionary`2 blocks, Block block) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Decompiler.cs:line 795
   at UndertaleModLib.Decompiler.Decompiler.DirectFunctionCall.DoTypePropagation(DecompileContext context, AssetIDType suggestedType) in D:\a\UndertaleModTool\UndertaleModTool\UndertaleModLib\Decompiler\Instructions\Decompiler.DirectFunctionCall.cs:line 139
*/
function player_action_change_ammo() //gml_Script_player_action_change_ammo
{
    if global.change_ammo_now
    {
        if (keyboard_check_pressed(vk_anykey) && (!(global.kb_pressed[(23 << 0)])))
            global.change_ammo_now = false
    }
    if global.change_ammo_now
    {
        if (mouse_wheel_up() || obj_gamepad.action[(33 << 0)].pressed)
            global.change_ammo_scelta++
        if (mouse_wheel_down() || obj_gamepad.action[(34 << 0)].pressed)
            global.change_ammo_scelta--
        global.change_ammo_scelta = clamp(global.change_ammo_scelta, 0, (ds_list_size(global.list_ammo_id) - 1))
        if (global.kb_pressed[(23 << 0)] || gamepad_hold_released((3 << 0)))
        {
            global.change_ammo_now = false
            var _ammo_id_scelto = ds_list_find_value(global.list_ammo_id, global.change_ammo_scelta)
            if (_ammo_id_scelto != gml_Script_player_loadout_get_ammo_item(self, weapon_slot_now))
            {
                inventory_add_item(gml_Script_player_loadout_get_ammo_item(self, weapon_slot_now), gml_Script_player_loadout_get_ammo(self, weapon_slot_now))
                player_loadout_set_ammo(weapon_slot_now, 0)
                player_loadout_set_ammo_item(weapon_slot_now, _ammo_id_scelto)
                alarm[0] = 60 * audio_sound_length(item_weapon_get_sound_mag_out(arma_now)) * (global.sk_k[(17 << 0)])
                reloading = true
                state_reload = (0 << 0)
                if (gml_Script_player_loadout_get_ammo(self, weapon_slot_now) <= 0 && item_weapon_get_reload_type(arma_now) == "magazine")
                    reload_cocking = true
                audio_play_sound(item_weapon_get_sound_mag_out(arma_now), 10, false)
                db_open(inventory_target_db())
                var _loot_array = db_read("Inventory", "items", [])
                db_close()
                if is_in_hub()
                    gml_Script_db_force_save("pre_raid")
            }
        }
    }
    if ((global.kb_pressed[(23 << 0)] || obj_gamepad.input_duration[(3 << 0)] == obj_gamepad.hold_frames) && global.change_ammo_now == false && item_exists(arma_now) && reloading == false && (!switching_weapon))
    {
        global.change_ammo_now = true
        var _t_ammo = item_get_name(gml_Script_player_loadout_get_ammo_item(self, weapon_slot_now))
        var _t = (language_get_string("Currently using:")) + " " + _t_ammo
        scr_draw_text_with_box(_t)
        ds_list_clear(global.list_ammo_id)
        ds_list_clear(global.list_ammo_qnt)
        var _caliber_now = item_weapon_get_caliber(arma_now)
        var _ammo_item_array = variable_struct_get(global.caliber_ammo_data, _caliber_now)
        var _a_ammo_qnt = array_create(array_length(_ammo_item_array), 0)
        db_open(inventory_target_db())
        _loot_array = db_read("Inventory", "items", [])
        db_close()
        var _i = 0
        repeat array_length(_loot_array)
        {
            var _loot = _loot_array[_i]
            var _ammo_index = array_find_index(_ammo_item_array, _loot.item)
            if (_ammo_index != undefined)
                _a_ammo_qnt[_ammo_index] += _loot.quantity
            _i++
        }
        _i = 0
        repeat array_length(_ammo_item_array)
        {
            if (_a_ammo_qnt[_i] > 0)
            {
                ds_list_add(global.list_ammo_id, _ammo_item_array[_i])
                ds_list_add(global.list_ammo_qnt, _a_ammo_qnt[_i])
            }
            _i++
        }
    }
    if (ds_list_size(global.list_ammo_id) < 1 || shoot_input == true || hspd != 0 || vspd != 0)
        global.change_ammo_now = false
    return true;
}

